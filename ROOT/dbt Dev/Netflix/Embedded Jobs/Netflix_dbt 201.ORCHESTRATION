{"job":{"components":{"318715":{"id":318715,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":989533025,"x":400,"y":352,"width":32,"height":32,"inputConnectorIDs":[318767],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dbt_snowflake_monitoring"}}}},"visible":true},"2":{"slot":2,"name":"External file source","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dbt matillion netflix repo dev_may2023"}}}},"visible":true},"3":{"slot":3,"name":"Command","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dbt run --select dbt_snowflake_monitoring"}}}},"visible":true},"4":{"slot":4,"name":"Config","elements":{},"visible":true},"5":{"slot":5,"name":"Map Environment Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"target_database"},"2":{"slot":2,"type":"STRING","value":"${ev_target_database}"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"target_schema"},"2":{"slot":2,"type":"STRING","value":"${ev_target_schema}"}}}},"visible":true},"6":{"slot":6,"name":"Folder Path","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"318751":{"id":318751,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":989533025,"x":400,"y":288,"width":32,"height":32,"inputConnectorIDs":[318766],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[318760],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"metadata validation"}}}},"visible":true},"2":{"slot":2,"name":"External file source","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dbt matillion netflix repo dev_may2023"}}}},"visible":true},"3":{"slot":3,"name":"Command","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dbt test --select stg_search_analysis"}}}},"visible":true},"4":{"slot":4,"name":"Config","elements":{},"visible":true},"5":{"slot":5,"name":"Map Environment Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"target_database"},"2":{"slot":2,"type":"STRING","value":"${ev_target_database}"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"target_schema"},"2":{"slot":2,"type":"STRING","value":"${ev_target_schema}"}}}},"visible":true},"6":{"slot":6,"name":"Folder Path","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"318752":{"id":318752,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186829,"x":912,"y":288,"width":32,"height":32,"inputConnectorIDs":[318763],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[318762],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dbt log --> grid variable"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"# This script converts\n# THE MESSAGE EXPORT from the RUN DBT COMMAND COMPONENT (jv_dbt_exports_message)\n# to a MATILLION GRID VARIABLE (gv_dbt_tasks)\n\n#CREATE FUNCTION TO CONVERT MULTI-LINE STRING TO LIST\ndef split_lines(s):\n  return s.split('\\n')\n\n#RUN jv_dbt_tests_message THROUGH FUNCTION\ndbt_output = split_lines(jv_dbt_tests_message)\n\n#LOOP THROUGH LIST OUTPUT AND CREATE NEW LIST WITH PASS/FAIL ENTRIES\ndbt_output_task_list = []\nfor each in dbt_output:\n  if \" of \" in each:\n    dbt_output_task_list.append(each)\n      \nprint(dbt_output_task_list)\n\n#PARSE THROUGH EACH ITEM AND CONVERT EACH PASS/FAIL ENTRY TO DATAPOINTS WITHIN GV\ntotal_task = ''\nnumber_task = ''\ntask_name = ''\nresult = ''\nduration = ''\ngv_list = []\n\nfor item in dbt_output_task_list:\n  if \"OK\" in item:\n    item_list = []\n    item_parse = item.split(' ')\n    number_task = item_parse[2]\n    item_list.append(number_task)\n    total_task = item_parse[4]\n    item_list.append(total_task)\n    result = item_parse[5]\n    item_list.append(result)\n    task_name = item_parse[10]\n    item_list.append(task_name)\n    duration = item_parse[-1].split(\"'\")[0][:-1]\n    item_list.append(duration)\n    gv_list.append(item_list)\n  elif (\"PASS\" or \"FAIL\") in item:\n    item_list = []\n    item_parse = item.split(' ')\n    number_task = item_parse[2]\n    item_list.append(number_task)\n    total_task = item_parse[4]\n    item_list.append(total_task)\n    result = item_parse[5]\n    item_list.append(result)\n    task_name = item_parse[6]\n    item_list.append(task_name)\n    duration = item_parse[-1].split(\"'\")[0][:-1]\n    item_list.append(duration)\n    gv_list.append(item_list)\n\ncontext.updateGridVariable('gv_dbt_tasks', gv_list)\n\nprint (context.getGridVariable('gv_dbt_tasks'))\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true},"5":{"slot":5,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Restricted"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"318753":{"id":318753,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":1056,"y":288,"width":32,"height":32,"inputConnectorIDs":[318762],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Netflix_LogtoTable"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Netflix_LogtoTable"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{"1":{"slot":1,"elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"GRID","value":"gv_dbt_tasks"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"GRID","value":"task_num"},"2":{"slot":2,"type":"GRID","value":"task_total"},"3":{"slot":3,"type":"GRID","value":"task_name"},"4":{"slot":4,"type":"GRID","value":"task_result"},"5":{"slot":5,"type":"GRID","value":"task_duration"}}}},"values":{"1":{"slot":1,"type":"STRING","value":"gv_dbt_xtasks"},"2":{"slot":2,"type":"STRING","value":"grid"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"318754":{"id":318754,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":989533025,"x":528,"y":288,"width":32,"height":32,"inputConnectorIDs":[318760],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[318765],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dbt clean"}}}},"visible":true},"2":{"slot":2,"name":"External file source","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dbt matillion netflix repo dev_may2023"}}}},"visible":true},"3":{"slot":3,"name":"Command","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dbt clean"}}}},"visible":true},"4":{"slot":4,"name":"Config","elements":{},"visible":true},"5":{"slot":5,"name":"Map Environment Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"target_database"},"2":{"slot":2,"type":"STRING","value":"${ev_target_database}"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"target_schema"},"2":{"slot":2,"type":"STRING","value":"${ev_target_schema}"}}}},"visible":true},"6":{"slot":6,"name":"Folder Path","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"318755":{"id":318755,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":989533025,"x":768,"y":288,"width":32,"height":32,"inputConnectorIDs":[318765],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[318763],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Message","mapTo":"jv_dbt_tests_message"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dbt build"}}}},"visible":true},"2":{"slot":2,"name":"External file source","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dbt matillion netflix repo dev_may2023"}}}},"visible":true},"3":{"slot":3,"name":"Command","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dbt build --select netflix_search"}}}},"visible":true},"4":{"slot":4,"name":"Config","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"'threads'"},"2":{"slot":2,"type":"STRING","value":"2"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"'debug'"},"2":{"slot":2,"type":"STRING","value":"true"}}}},"visible":true},"5":{"slot":5,"name":"Map Environment Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"target_database"},"2":{"slot":2,"type":"STRING","value":"${ev_target_database}"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"target_schema"},"2":{"slot":2,"type":"STRING","value":"${ev_target_schema}"}}}},"visible":true},"6":{"slot":6,"name":"Folder Path","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"318756":{"id":318756,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":989533025,"x":272,"y":288,"width":32,"height":32,"inputConnectorIDs":[318764],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[318766,318767,318772],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dbt deps"}}}},"visible":true},"2":{"slot":2,"name":"External file source","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dbt matillion netflix repo dev_may2023"}}}},"visible":true},"3":{"slot":3,"name":"Command","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dbt deps"}}}},"visible":true},"4":{"slot":4,"name":"Config","elements":{},"visible":true},"5":{"slot":5,"name":"Map Environment Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"target_database"},"2":{"slot":2,"type":"STRING","value":"${ev_target_database}"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"target_schema"},"2":{"slot":2,"type":"STRING","value":"${ev_target_schema}"}}}},"visible":true},"6":{"slot":6,"name":"Folder Path","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"318757":{"id":318757,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":989533025,"x":400,"y":416,"width":32,"height":32,"inputConnectorIDs":[318772],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Message","mapTo":"jv_dbt_tests_message"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pii masking"}}}},"visible":true},"2":{"slot":2,"name":"External file source","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dbt matillion netflix repo dev_may2023"}}}},"visible":true},"3":{"slot":3,"name":"Command","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dbt run --m netflix_search"}}}},"visible":true},"4":{"slot":4,"name":"Config","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"'threads'"},"2":{"slot":2,"type":"STRING","value":"2"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"'debug'"},"2":{"slot":2,"type":"STRING","value":"true"}}}},"visible":true},"5":{"slot":5,"name":"Map Environment Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"target_database"},"2":{"slot":2,"type":"STRING","value":"${ev_target_database}"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"target_schema"},"2":{"slot":2,"type":"STRING","value":"${ev_target_schema}"}}}},"visible":true},"6":{"slot":6,"name":"Folder Path","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"318758":{"id":318758,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1286515545,"x":144,"y":288,"width":32,"height":32,"inputConnectorIDs":[318761],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[318764],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Sync Dev Branch"}}}},"visible":true},"2":{"slot":2,"name":"External file source","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dbt matillion netflix repo dev_may2023"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"318759":{"id":318759,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-16,"y":288,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[318761],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{},"failureConnectors":{},"unconditionalConnectors":{"318760":{"id":318760,"sourceID":318751,"targetID":318754},"318761":{"id":318761,"sourceID":318759,"targetID":318758},"318762":{"id":318762,"sourceID":318752,"targetID":318753},"318763":{"id":318763,"sourceID":318755,"targetID":318752},"318764":{"id":318764,"sourceID":318758,"targetID":318756},"318765":{"id":318765,"sourceID":318754,"targetID":318755},"318766":{"id":318766,"sourceID":318756,"targetID":318751},"318767":{"id":318767,"sourceID":318756,"targetID":318715},"318772":{"id":318772,"sourceID":318756,"targetID":318757}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{"318713":{"id":318713,"x":713,"y":243,"width":406,"height":99,"text":"** 5. One command to rule them all **","colour":"f9c21b"},"318714":{"id":318714,"x":225,"y":245,"width":368,"height":213,"text":"** 4. Comprehensive dbt functionality including custom packages **","colour":"f9c21b"}},"variables":{"jv_dbt_tests_message":{"definition":{"name":"jv_dbt_tests_message","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"DEFAULT TESTS MESSAGE"},"jv_target_database":{"definition":{"name":"jv_target_database","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"PC_MATILLION_DB"},"jv_target_schema":{"definition":{"name":"jv_target_schema","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"PUBLIC"},"jv_test_name":{"definition":{"name":"jv_test_name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"jv_test_result":{"definition":{"name":"jv_test_result","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""}},"grids":{"gv_dbt_tasks":{"definition":{"name":"gv_dbt_tasks","scope":"BRANCH","definitions":[{"name":"task_num","type":"TEXT"},{"name":"task_total","type":"TEXT"},{"name":"task_name","type":"TEXT"},{"name":"task_result","type":"TEXT"},{"name":"task_duration","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[{"values":["0","0","DEFAULT_NAME","DEFAULT_RESULT","0.00"]}]}}},"info":{"name":"Netflix_dbt 201","description":"","type":"ORCHESTRATION","tag":"c2b54de3-0f10-4d54-879b-5760a9e9bb4f"}}